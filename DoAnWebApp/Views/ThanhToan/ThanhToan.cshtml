@using DoAnWebApp.Models
@using System.Globalization
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Thanh toán";
    var session = HttpContextAccessor.HttpContext.Session;

    bool isMuaNgay = session.GetString("isMuaNgay") == "true";
    double tongTien = Model.TongTien;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Thanh toán</title>
    @* <link rel="stylesheet" href="~/css/thanhtoan.css" /> *@
    <style>
        body { font-family: Arial; margin:40px; background:#fafafa; }
        h2 { text-align:center; color:#28a745; }
        table { width:100%; border-collapse: collapse; background:white; 
                box-shadow:0 0 8px #ddd; border-radius:10px; overflow:hidden;}
        th, td { padding:10px; text-align:center; border-bottom:1px solid #ddd;}
        th { background:#28a745; color:white;}
        .img-thumb { width:80px; height:80px; object-fit:cover; border-radius:10px;}
        .btn { background:#28a745; color:white; padding:10px 20px; border-radius:5px; border:none; cursor:pointer;}
        .btn:hover { background:#218838;}
        .actions { text-align:center; margin-top:20px;}
        .info-box { background:white; padding:20px; box-shadow:0 0 8px #ddd; border-radius:10px; margin-top:30px;}
        input, select, textarea { width:100%; padding:10px; margin-top:8px; border-radius:5px; border:1px solid #ccc;}
        label { font-weight:bold; color:#333;}
    </style>
</head>
<body>

<h2>💳 Xác nhận Thanh Toán</h2>

@if (Model.SanPhamList == null || !Model.SanPhamList.Any())
{
    <h3 style="color:red; text-align:center;">❌ Không có sản phẩm nào để thanh toán!</h3>
    <div style="text-align:center;">
        <a href="/giohang" class="btn" style="background:#6c757d;">⬅️ Quay lại giỏ hàng</a>
    </div>
}
else
{
    <table>
        <tr>
            <th>Hình</th>
            <th>Tên sản phẩm</th>
            <th>Đơn giá</th>
            <th>Số lượng</th>
            <th>Thành tiền</th>
        </tr>

        @foreach (var sp in Model.SanPhamList)
        {
            <tr>
                <td>
                    <img src="~/IMG/@sp.Anh" class="img-thumb" />
                </td>
                <td>@sp.TenSP</td>
                <td>@string.Format("{0:N0} ₫", sp.DonGia)</td>
                <td>@sp.SoLuong</td>
                <td style="color:#d6336c;">
                    @string.Format("{0:N0} ₫", sp.ThanhTien)
                </td>
            </tr>
        }
    </table>

    <h3 style="text-align:center; margin-top:20px;">
        Tổng cộng: <span style="color:#e83e8c;">@string.Format("{0:N0} ₫", tongTien)</span>
    </h3>

    <div class="info-box">
        <form method="post" action="/ThanhToan/XacNhan">
            <label>👤 Họ và tên:</label>
            <input type="text" name="hoten" required placeholder="Nhập họ tên..." />

            <label>📞 Số điện thoại:</label>
            <input type="text" name="sdt" required placeholder="Nhập số điện thoại..." />

            <label>🏠 Địa chỉ giao hàng:</label>
            <textarea name="diachi" rows="3" required placeholder="Nhập địa chỉ nhận hàng..."></textarea>

            <label>💰 Phương thức thanh toán:</label>
            <select name="phuongthuc" required>
                <option value="">-- Chọn phương thức --</option>
                <option value="cod">Thanh toán khi nhận hàng (COD)</option>
                <option value="bank">Chuyển khoản ngân hàng</option>
                <option value="momo">Ví MoMo</option>
            </select>

            <div class="actions">
                @if (isMuaNgay)
                {
                    <a href="/TrangChu" class="btn" style="background:#6c757d;">⬅️ Tiếp tục mua sắm</a>
                }
                else
                {
                    <a href="/giohang" class="btn" style="background:#6c757d;">⬅️ Quay lại giỏ hàng</a>
                }

                <button type="submit" class="btn">✅ Xác nhận thanh toán</button>
            </div>
        </form>
    </div>
}

</body>
</html>
